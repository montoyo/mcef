/*! jquery.tube.js 0.2.7 | https://github.com/inukshuk/jquery.tube.js/blob/master/LICENSE */
!function(t,e,i,n,o){"use strict";String.prototype.supplant||(String.prototype.supplant=function(t){return this.replace(/\{([^{}]*)\}/g,function(e,i){var n=t[i];return"string"==typeof n||"number"==typeof n?n:e})}),Array.prototype.remove=function(t,e){var i=this.slice((e||t)+1||this.length);return this.length=0>t?this.length+t:t,this.push.apply(this,i)};var s=function(e){return e=e||{},this.on=function(i,n){return e[i]=e[i]||[],t.isFunction(n)&&e[i].push(n),this},this.once=function(t,e){var i=this;return this.on(t,function(){i.off(t,e),e.apply(i,arguments)})},this.off=function(t,i){if(e[t]){var n,o=e[t],s=[];if(i){for(n=0;n<o.length;++n)o[n]===i&&s.push(n);for(n=0;s>n;++n)o.remove(n)}else e[t]=[]}return this},this.notify=function(){var i=this,n=Array.prototype.slice.apply(arguments),o=arguments[0];return e[o]&&t.each(e[o],function(){t.isFunction(this)&&this.apply(i,n)}),this},this},r=function(e){this.statistics={},this.thumbnails=[],this.acl={},e&&t.extend(this,e)};r.constants={users:"//www.youtube.com/user/{name}"},r.templates={thumbnail:'<img src="{url}" title="{title}" />',title:"<h1>{title} ({duration})</h1>",author:'<a href="{author_url}">{author}</a>',description:"<p>{description}</p>",statistics:'<span class="statistics">{views} / {favorites} / {uploaded}</span>',video:'<a href="#{id}" rel="{index}">{title}{thumbnail}{description}<p>{author} \u2013 {statistics}</p></a>'},r.parameters={v:2,alt:"json-in-script",callback:"?"},r.defaults={truncate:!1,at:"\n",max:140,omission:"\u2026",thumbnail:"mqdefault",index:0};var a=function(t,e){var i,n=t.length;return e.at&&(i=t.indexOf(e.at))>=0&&(n=Math.min(n,i)),e.max?e.omission&&n-e.omission.length>e.max?t.slice(0,e.max-e.omission.length)+e.omission:t.slice(0,Math.min(e.max,n)):t.slice(0,n)},p=function(t){return("0"+t).slice(-2)},u=function(t){return null===t?"":"object"!=typeof t?t:[t.getDate(),t.getMonth()+1,t.getFullYear()].join(".")};r.prototype.parse=function(e){var i=this;try{if(e.author&&t.isArray(e.author)&&(this.author={name:e.author[0].name.$t,id:e.author[0].uri.$t.match(/\/([^\/]*)$/)[1]},this.author.url=r.constants.users.supplant(this.author)),e.yt$statistics&&(this.statistics.favorites=e.yt$statistics.favoriteCount,this.statistics.views=e.yt$statistics.viewCount),e.yt$accessControl&&e.yt$accessControl.length&&t.each(e.yt$accessControl,function(){i.acl[this.action]=this.permission}),e.title&&(this.title=e.title.$t),e.updated)try{this.updated=new Date(Date.parse(e.updated.$t)||Date.parse(e.updated.$t.replace(/-/g,"/").replace(/T.*/,"")))}catch(n){}if(e.media$group){var o=e.media$group;if(o.yt$videoid&&(this.id=o.yt$videoid.$t),o.media$description&&(this.description=o.media$description.$t),o.yt$duration&&(this.duration_in_seconds=parseInt(o.yt$duration.seconds,10)),o.yt$uploaded)try{this.uploaded=new Date(Date.parse(o.yt$uploaded.$t)||Date.parse(o.yt$uploaded.$t.replace(/-/g,"/").replace(/T.*/,"")))}catch(n){}o.media$thumbnail&&t.isArray(o.media$thumbnail)&&(this.thumbnails=t.map(o.media$thumbnail,function(t){return{width:t.width,height:t.height,url:t.url.replace(/^https?:\/\//,"//"),name:t.yt$name}}))}}catch(n){console.log(n)}return this},r.prototype.load=function(e,i){var n=this;return n.id=e,t.getJSON(n.request(),function(e){try{e.entry&&n.parse(e.entry),i&&t.isFunction(i)&&i.apply(n,[1,e,n])}catch(o){i&&t.isFunction(i)&&i.apply(n,[0,o,n])}}),this},r.prototype.request=function(t){return t=t||r.parameters,[l.constants.api,"videos","/",this.id,"?",l.serialize(t)].join("")},r.prototype.seconds=function(){return(this.duration_in_seconds||0)%60},r.prototype.minutes=function(){return parseInt((this.duration_in_seconds||0)/60,10)%60},r.prototype.hours=function(){return parseInt((this.duration_in_seconds||0)/3600,10)},r.prototype.duration=function(){if(!this.duration_in_seconds)return"";var t=this.hours(),e=this.minutes(),i=this.seconds();return(t?[t,p(e),p(i)]:[e,p(i)]).join(":")},r.prototype.visibility=function(){return this.is_listed()?"listed":"unlisted"},r.prototype.is_listed=function(){return"denied"!==this.acl.list},r.prototype.properties=function(e){if("string"==typeof e.thumbnail){var i=0;t.each(this.thumbnails,function(t){return this.name===e.thumbnail?(i=t,!1):void 0}),e.thumbnail=i}return{id:this.id,index:e.index,title:this.title,duration:this.duration(),description:e.truncate?a(this.description,e):this.description,author:this.author.name,author_url:this.author.url,views:this.statistics.views,visibility:this.visibility(),favorites:this.statistics.favorites,uploaded:u(this.uploaded),updated:u(this.updated),url:this.thumbnails[e.thumbnail].url}},r.prototype.render=function(e,i){var n=this.properties(t.extend({},r.defaults,i));return e=t.extend({},r.templates,e),e.video.supplant({id:n.id,index:n.index,visibility:n.visibility,title:e.title.supplant(n),thumbnail:e.thumbnail.supplant(n),description:e.description.supplant(n),author:e.author.supplant(n),statistics:e.statistics.supplant(n)})};var l=function(e){var i=this;this.videos=[],this.options=t.extend({},l.defaults,e),this.current=0,this.player=c.create(this.player_options()),this.options.templates=t.extend({},r.templates,this.options.templates||{}),s.apply(this),t.each(l.events,function(t,e){i.options.events[e]&&i.on(e,i.options.events[e])}),t.each(c.events,function(e,n){i.player.on(n,t.proxy(i.notify,i,n)),i.options.events[n]&&i.on(n,i.options.events[n])})};l.constants={api:"//gdata.youtube.com/feeds/api/"},l.defaults={player:"player",autoload:!1,autoplay:!1,start:0,order:"relevance",author:!1,hide:2,controls:1,version:2,format:5,limit:10,key:!1,render:!0,truncate:!1,at:"\n",max:140,omission:"\u2026",events:[],load:!1,complete:!1,click:!1},l.parameters={q:"query","max-results":"limit",key:"key",format:"format",orderby:"order",author:"author",v:"version"},l.events=["load","ready","stop","error"],l.serialize=function(e){var i;switch(typeof e){case"string":i=encodeURI(e);break;case"object":i=null===e?"":t.map(e,function(t,e){return t?[encodeURI(e),encodeURI(t)].join("="):void 0}).join("&");break;default:i=""}return i},l.prototype.load=function(e){var i,n=this,o=0;return this.options.list&&this.options.list.length?(i=function(i,s){0===i&&(e&&t.isFunction(e)&&e.apply(n,[o,s]),n.notify("error")),++o>=n.options.list.length&&(n.notify("load"),e&&t.isFunction(e)&&e.apply(n,[o]),n.notify("ready"))},this.videos=t.map(this.options.list,function(t){return(new r).load(t,i)})):t.getJSON(this.request(),function(i){try{o=i.feed.entry.length,n.videos=t.map(i.feed.entry,function(t){return(new r).parse(t)}),o&&(n.options.autoload||n.options.start)&&(n.current=Math.min(n.videos.length-1,Math.max(0,n.options.start-1)),n.player.load(n.videos[n.current])),n.notify("load"),e&&t.isFunction(e)&&e.apply(n,[o]),n.notify("ready")}catch(s){e&&t.isFunction(e)&&e.apply(n,[0,s]),n.notify("error")}}),this},l.prototype.player_options=function(){return{id:this.options.player,playerVars:t.extend({},c.parameters,{autoplay:this.options.autoplay,autohide:this.options.hide,controls:this.options.controls})}},l.prototype.parameters=function(){var e=this,i={};return t.each(l.parameters,function(t,n){e.options[n]&&(i[t]=e.options[n])}),this.options.playlist?delete i.orderby:this.options.user&&(i.orderby="published"),i.alt="json-in-script",i.callback="?",i},l.prototype.request=function(e){var i=l.constants.api;return t.extend(this.options,e||{}),i+=this.options.playlist?"playlists/"+this.options.playlist.replace(/^PL/,""):this.options.user?["users",this.options.user,"uploads"].join("/"):"videos",[i,"?",l.serialize(this.parameters())].join("")},l.prototype.authenticate=function(){return this},l.prototype.play=function(e){if(t.isNumeric(e)){var i=e%this.videos.length;this.current=0>i?this.videos.length-i:i,this.player&&this.videos.length&&this.player.play(this.videos[this.current])}else this.player.resume();return this},l.prototype.pause=function(){return this.player&&this.player.pause(),this},l.prototype.stop=function(){return this.player&&(this.player.stop(),this.notify("stop")),this},l.prototype.next=function(){return this.advance(1).notify("next")},l.prototype.previous=function(){return this.advance(-1).notify("previous")},l.prototype.advance=function(t){return this.play(this.current+(t||1))},l.prototype.render_options=function(e){return t.extend({},r.defaults,this.options,e||{})},l.prototype.render=function(){var e=this.options.templates,i=this.render_options(),n=t.map(this.videos,function(t,n){return i.index=n,"<li>"+t.render(e,i)+"</li>"});return"<ol>"+n.join("")+"</ol>"};var c=function(e){var i=this;this.options=t.extend({},c.defaults,e),this.p=null,s.apply(this),this.on("state",function(e,i){var n=t.isNumeric(i)?i:i&&i.data;switch(n){case-1:this.notify("unstarted");break;case 0:this.notify("end");break;case 1:this.notify("play");break;case 2:this.notify("pause");break;case 3:this.notify("buffer");break;case 5:this.notify("cue")}}),t.each(c.events,function(t,e){i.options.events[e]&&i.on(e,i.options.events[e])})};c.create=function(e){var i,n;return e=t.extend({},c.defaults,e),e.playerVars=t.extend(c.parameters,e.playerVars||{}),e.id=h(e.id),i=t("#"+e.id),n=i.data("player"),n||(n=new c(e),i.data("player",n)),n},c.constants={swfobject:"//ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"},c.constants.events={onReady:"ready",onStateChange:"state",onPlaybackQualityChange:"quality",onError:"error"},c.defaults={id:"player",width:640,height:390,wmode:"opaque",events:{}},c.parameters={autohide:2,autoplay:0,controls:1,start:0,enablejsapi:1,loop:0,modestbranding:1},c.callbacks=[],c.semaphore=0,c.events=["unstarted","end","play","cue","buffer","pause","error"];var h=function(e){return/^#|\./.test(e)?t(e).attr("id")||e:e};c.prototype.play=function(t){return this.p?(t?(this.p.current_video=t,this.p.loadVideoById(t.id||t,0,this.options.quality)):this.p.playVideo(),this):this.load(t)},c.prototype.resume=function(){return this.p&&this.p.playVideo(),this},c.prototype.pause=function(){return this.p&&this.p.pauseVideo(),this},c.prototype.stop=function(){return this.p&&this.p.stopVideo(),this},c.prototype.seek=function(t,e){return this.p&&(o===e&&(e=!0),this.p.seekTo(t,e)),this},c.prototype.clear=function(){return this.p&&(this.p.stopVideo(),this.p.clearVideo()),this},c.prototype.current_video=function(t){var i=this.p&&this.p.current_video;return i&&!i.id?(this.video=(new r).load(i,t),this.video):("function"==typeof t&&e.setTimeout(function(){t.apply(i,[1,!1,i])},0),i)},"function"==typeof e.postMessage?(c.api="iframe",c.constants.api="https://www.youtube.com/player_api",c.prototype.event_proxy_for=function(e){return t.proxy(this.notify,this,e)},c.load=function(e){if("undefined"==typeof YT){var n=i.createElement("script");return"function"==typeof e&&c.callbacks.push(e),0===c.semaphore&&(c.semaphore=1,n.src=c.constants.api,t("script:first").before(n)),!1}return"function"==typeof e&&setTimeout(e,0),!0},c.prototype.load=function(e){var i=this,n=t.extend({},this.options,{videoId:e.id||e,events:{}}),o=t("#"+n.id);return c.load(function(){try{t.each(c.constants.events,function(t,e){n.events[t]=i.event_proxy_for(e)}),i.p=new YT.Player(n.id,n),e&&(i.p.current_video=e)}catch(s){o.append("Failed to load YouTube player: "+s.toString())}}),this},e.onYouTubeIframeAPIReady=function(){t.each(c.callbacks,function(){this.call()})}):(c.api="js",c.constants.api="//www.youtube.com/v/{video}?enablejsapi=1&playerapiid={id}&version=3",c.constants.swf_version="8",c.parameters.autoplay=1,c.prototype.event_proxy_for=function(t){var i=this,n=this.options.id.replace(/[\s-]/g,"_"),o=["event_proxy_for_player",n,t].join("_");return e[o]=function(){var e=Array.prototype.slice.apply(arguments);e.unshift(t),i.notify.apply(i,e)},o},c.load=function(e){return"undefined"==typeof swfobject?(t.getScript(c.constants.swfobject,function(){"function"==typeof e&&e.call()}),!1):("function"==typeof e&&setTimeout(e,0),!0)},c.prototype.load=function(e){{var n=this,o=t.extend({},this.options,{videoId:e.id||e,events:{}});t("#"+o.id)}return c.load(function(){try{c.callbacks.push(function(o){n.p=i.getElementById(o),t.each(c.constants.events,function(t,e){n.p.addEventListener(t,n.event_proxy_for(e))}),e&&(n.p.current_video=e)}),swfobject.embedSWF(c.constants.api.supplant({video:o.videoId,id:o.id}),o.id,o.width,o.height,c.constants.swf_version,null,o.playerVars,{allowScriptAccess:"always",wmode:"opaque"},{id:o.id})}catch(s){console.log("Failed to load YouTube player: ",s)}}),this},e.onYouTubePlayerReady=function(){var i=arguments;t.each(c.callbacks,function(){this.apply(e,i)})}),t.fn.tube=function(e){var i,n;return this.length&&(n="string"==typeof e?{query:e}:e,i=this.first(),i.data("tube",new l(n).load(function(e){var n,o=this;e?(o.options.render&&(n=t(o.render()),t("a[rel]",n).click(function(e){t.isFunction(o.options.click)&&o.options.click.apply(o,["click",this,e]),o.play(t(this).attr("rel"))}),t.isFunction(o.options.load)&&o.options.load.apply(o,["load",n,i]),i.append(n)),t.isFunction(o.options.complete)&&o.options.complete.apply(o,["complete",n,i])):t.isFunction(o.options.complete)&&o.options.complete.apply(o,["error",n,i])}))),this},t.fn.player=function(e){var i,n;return this.length&&(n="string"==typeof e?t.extend({},t.player.defaults,{video:e}):t.extend({},t.player.defaults,e),i=this.first(),i.data("player")?i.data("player").play(n.video):(n.id=i.attr("id"),n.id||(i.attr("id","jquery-tube-player-"+t.player.counter++),n.id=i.attr("id")),n.video&&c.create(n).load(n.video))),this},t.tube={},t.tube.load_video=function(t,e){return(new r).load(t,e)},t.tube.constants=l.constants,t.tube.defaults=l.defaults,t.player={},t.player.defaults=c.defaults,t.player.counter=0}(jQuery,window,window.document,"0.2.7");
